---
 drivers/mtd/nand/plat_nand.c |   13 ++++++++++++-
 include/linux/mtd/nand.h     |    1 +
 2 files changed, 13 insertions(+), 1 deletion(-)

Index: linux-3.18.140/include/linux/mtd/nand.h
===================================================================
--- linux-3.18.140.orig/include/linux/mtd/nand.h
+++ linux-3.18.140/include/linux/mtd/nand.h
@@ -851,6 +851,7 @@ struct platform_nand_chip {
 	unsigned int options;
 	unsigned int bbt_options;
 	const char **part_probe_types;
+	int (*chip_fixup)(struct mtd_info *mtd);
 };
 
 /* Keep gcc happy */
Index: linux-3.18.140/drivers/mtd/nand/plat_nand.c
===================================================================
--- linux-3.18.140.orig/drivers/mtd/nand/plat_nand.c
+++ linux-3.18.140/drivers/mtd/nand/plat_nand.c
@@ -90,7 +90,18 @@ static int plat_nand_probe(struct platfo
 	}
 
 	/* Scan to find existence of the device */
-	if (nand_scan(&data->mtd, pdata->chip.nr_chips)) {
+	if (nand_scan_ident(&data->mtd, pdata->chip.nr_chips, NULL)) {
+		err = -ENXIO;
+		goto out;
+	}
+
+	if (pdata->chip.chip_fixup) {
+		err = pdata->chip.chip_fixup(&data->mtd);
+		if (err)
+			goto out;
+	}
+
+	if (nand_scan_tail(&data->mtd)) {
 		err = -ENXIO;
 		goto out;
 	}
