#!/bin/sh

. /lib/functions.sh
. /lib/functions/uci-defaults.sh
. /lib/functions/system.sh

board_config_update
board=$(cat /tmp/sysinfo/board_name)

case $board in
	actionrg1200-v1)
		ucidef_add_switch "switch0" \
			"6@eth0" "0:lan" "1:lan" "2:lan" "3:wan"
		;;
	re708-v1)
		ucidef_add_switch "switch0" \
			"6@eth0" "0:lan" "1:lan" "2:lan" "3:lan" "4:wan"
		;;
	gf1200-v1|\
	actionrf1200-v1|\
	w5-1200f-v1|\
	maxlinkac1200g-v1|\
	gwr1200ac-v1|\
	gwr1200ac-v2)
		ucidef_add_switch "switch0" \
			"6@eth0" "1:lan" "2:lan" "3:lan" "0:wan"
		;;
esac

lan_mac=""
wan_mac=""

case $board in
	dir-815-d1)
		offset=$(strings -t x "$(find_mtd_part boot)" | grep llconfig | head -n 1 | awk '{ print "0x"$1 }')
		offset=$((offset+53))
		wan_mac=$(mtd_get_mac_binary boot $offset)
		lan_mac=$(macaddr_add "$wan_mac" 1)
		;;
	maxlinkac1200g-v1|\
	gwr1200ac-v1|\
	gwr1200ac-v2)
		wan_mac=$(mtd_get_mac_binary config 19)
		lan_mac=$(macaddr_add "$wan_mac" 1)
		;;
	actionrg1200-v1 | \
	actionrf1200-v1)
		wan_mac=$(mtd_get_mac_ascii config HW_NIC0_ADDR)
		lan_mac=$(macaddr_add "$wan_mac" 1)
		;;
	re708-v1|\
	gf1200-v1|\
	w5-1200f-v1)
		wan_mac=$(mtd_get_mac_binary config 7)
		lan_mac=$(macaddr_add "$wan_mac" 1)
		;;
	gwr-300n-v1)
		wan_mac=$(mtd_get_mac_binary boot 24595)
		lan_mac=$(mtd_get_mac_binary boot 24583)
		;;
	re172-v1)
		wan_mac=$(mtd_get_mac_binary boot 24583)
		lan_mac=$(mtd_get_mac_binary boot 24595)
esac

[ -n "$lan_mac" ] && ucidef_set_interface_macaddr "lan" $lan_mac
[ -n "$wan_mac" ] && ucidef_set_interface_macaddr "wan" $wan_mac

board_config_flush

exit 0
